<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Friend Finder Survey</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    </head>

    <body>
        <form>
            Please enter your name:
            <input type="text" id="name"> <br>
            Please submit a link to a photo of yourself:
            <input type="text" id="pic">

            <!-- yes I did take most of these questions almost verbatim from a myers-briggs type test. questions are difficult. -->
            <p>You enjoy social gatherings with lots of people.</p>
            <input type="radio" name="q1" value="1">(strongly disagree)
            <input type="radio" name="q1" value="2">
            <input type="radio" name="q1" value="3">
            <input type="radio" name="q1" value="4">
            <input type="radio" name="q1" value="5">(strongly agree)

            <p>If your friend is sad about something, your first instinct is to try and comfort them rather, not problem-solve.</p>
            <input type="radio" name="q2" value="1">(strongly disagree)
            <input type="radio" name="q2" value="2">
            <input type="radio" name="q2" value="3">
            <input type="radio" name="q2" value="4">
            <input type="radio" name="q2" value="5">(strongly agree)

            <p>People rarely upset you.</p>
            <input type="radio" name="q3" value="1">(strongly disagree)
            <input type="radio" name="q3" value="2">
            <input type="radio" name="q3" value="3">
            <input type="radio" name="q3" value="4">
            <input type="radio" name="q3" value="5">(strongly agree)

            <p>You are detail-oriented.</p>
            <input type="radio" name="q4" value="1">(strongly disagree)
            <input type="radio" name="q4" value="2">
            <input type="radio" name="q4" value="3">
            <input type="radio" name="q4" value="4">
            <input type="radio" name="q4" value="5">(strongly agree)

            <p>You prefer to listen to your heart rather than your head when making decisions.</p>
            <input type="radio" name="q5" value="1">(strongly disagree)
            <input type="radio" name="q5" value="2">
            <input type="radio" name="q5" value="3">
            <input type="radio" name="q5" value="4">
            <input type="radio" name="q5" value="5">(strongly agree)

            <p>You are good at staying calm under pressure.</p>
            <input type="radio" name="q6" value="1">(strongly disagree)
            <input type="radio" name="q6" value="2">
            <input type="radio" name="q6" value="3">
            <input type="radio" name="q6" value="4">
            <input type="radio" name="q6" value="5">(strongly agree)

            <p>You often make decisions on a whim.</p>
            <input type="radio" name="q7" value="1">(strongly disagree)
            <input type="radio" name="q7" value="2">
            <input type="radio" name="q7" value="3">
            <input type="radio" name="q7" value="4">
            <input type="radio" name="q7" value="5">(strongly agree)

            <p>You tend to focus on future possibilities rather than the present reality.</p>
            <input type="radio" name="q8" value="1">(strongly disagree)
            <input type="radio" name="q8" value="2">
            <input type="radio" name="q8" value="3">
            <input type="radio" name="q8" value="4">
            <input type="radio" name="q8" value="5">(strongly agree)

            <p>You find it easy to empathize with others.</p>
            <input type="radio" name="q9" value="1">(strongly disagree)
            <input type="radio" name="q9" value="2">
            <input type="radio" name="q9" value="3">
            <input type="radio" name="q9" value="4">
            <input type="radio" name="q9" value="5">(strongly agree)

            <p>You would find it difficult to spend an entire weekend alone without being bored.</p>
            <input type="radio" name="q10" value="1">(strongly disagree)
            <input type="radio" name="q10" value="2">
            <input type="radio" name="q10" value="3">
            <input type="radio" name="q10" value="4">
            <input type="radio" name="q10" value="5">(strongly agree)

            <br>
            <button type="submit" id="submit">Submit</button>
        </form>

        <p id="friend-match"></p>
        <img id="friend-pic">
    </body>
</html>

<script type="text/javascript">
    // once information is submitted, grab the information as an object
	$("#submit").on("click", function(){
        if($("#name").val().trim() === "") {
            event.preventDefault();
            alert("You must enter a name.");
        }
        else if ($("#pic").val().trim() === "" || !$("#pic").val().trim().includes("http" || "https")) {
            event.preventDefault();
            alert("You must enter a valid profile picture.");
        }
        else {
            // get array of scores first
            var scores = [];

            for(var i = 1; i <= 10; i++) {
                var radios = document.getElementsByName("q"+[i]);
                for(var j = 0; j < radios.length; j++) {
                    if(radios[j].checked) {
                        scores.push(radios[j].value);
                    }
                }
            }

            var newPerson = {
                name: $("#name").val().trim(),
                photo: $("#pic").val().trim(),
                scores: scores
            };

            console.log(newPerson);
            $.post("/api/friends", newPerson, function(data) {
                $("#friend-match").html(data.friendName);
                $("#friend-pic").attr("src", friendPic);
            });
        }
    });
</script>